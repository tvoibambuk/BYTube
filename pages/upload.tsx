import { useState } from 'react'\nimport { supabase } from '../lib/supabaseClient'\nimport { useRouter } from 'next/router'\n\nexport default function Upload() {\n  const [title, setTitle] = useState('')\n  const [file, setFile] = useState<File | null>(null)\n  const [loading, setLoading] = useState(false)\n  const router = useRouter()\n\n  async function handleUpload(e: any) {\n    e.preventDefault()\n    if (!file) return alert('Выберите файл')\n    if (!title) return alert('Введите заголовок')\n\n    setLoading(true)\n    try {\n      const fileExt = file.name.split('.').pop()\n      const fileName = `${Math.random().toString(36).slice(2)}.${fileExt}`\n      const filePath = `${fileName}`\n\n      const { error: uploadError } = await supabase.storage\n        .from('videos')\n        .upload(filePath, file, { cacheControl: '3600', upsert: false })\n\n      if (uploadError) throw uploadError\n\n      const { data, error } = await supabase.from('videos').insert([\n        {\n          title,\n          description: '',\n          filename: file.name,\n          path: filePath,\n          channel: 'MyChannel'\n        }\n      ]).select().single()\n\n      if (error) throw error\n\n      // Redirect to watch\n      router.push(`/watch/${data.id}`)\n    } catch (err: any) {\n      console.error(err)\n      alert('Ошибка: ' + err.message)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div>\n      <h2 className="text-lg font-semibold mb-3">Загрузка видео</h2>\n      <form onSubmit={handleUpload} className="flex flex-col gap-3">\n        <input value={title} onChange={(e)=>setTitle(e.target.value)} placeholder="Заголовок" className="p-2 rounded bg-white/5" />\n        <input type="file" accept="video/*" onChange={(e)=>setFile(e.target.files?.[0] ?? null)} />\n        <button type="submit" disabled={loading} className="px-3 py-2 rounded bg-accent text-white">\n          {loading ? 'Загрузка...' : 'Загрузить'}\n        </button>\n      </form>\n      <p className="text-sm text-[#94a3b8] mt-3">Файлы загружаются в Supabase Storage (bucket: videos).</p>\n    </div>\n  )\n}